package main

import (
	"os"
	"path"
	"testing"

	"github.com/stretchr/testify/require"

	"github.com/anchore/go-sync"
)

func Test_process(t *testing.T) {
	wd, err := os.Getwd()
	require.NoError(t, err)
	dbFile := path.Join(wd, "testdata", "results.db")
	cveListDir := path.Join(wd, "testdata", "cves")

	topTermCount = 4
	lookups := process(sync.NewExecutor(0), dbFile, cveListDir)

	searchTerms := getTextTerms("road-runner has a set of terms with a unique vulnerability")
	matches := lookupProduct(lookups, searchTerms)

	require.Len(t, matches, 1)
	require.Equal(t, "acme:road_runner:platypus", matches[0].product.cpe)
}
