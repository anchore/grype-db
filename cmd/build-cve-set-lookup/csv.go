package main

import (
	"encoding/csv"
	"fmt"
	"io"
	"os"

	"github.com/mitchellh/go-homedir"
)

func writeCSVFile(file string, records [][]string) {
	f := panget(os.Create(file))
	defer func() {
		logif(f.Close())
	}()
	writeCSV(f, records)
}

func writeCSV(writer io.Writer, records [][]string) {
	for _, r := range records {
		writeRow(writer, r...)
	}
}

func writeRow(writer io.Writer, values ...string) {
	for i, v := range values {
		if i > 0 {
			_ = logget(fmt.Fprint(writer, `,`))
		}
		_ = logget(fmt.Fprintf(writer, `"%s"`, v))
	}
	_ = logget(fmt.Fprintln(writer))
}

func cvesFromCSV(csvFile string) []string {
	var cves []string
	rdr := csv.NewReader(panget(os.Open(panget(homedir.Expand(csvFile)))))
	_, _ = rdr.Read() // skip headers
	for row, err := rdr.Read(); err == nil; row, err = rdr.Read() {
		cves = append(cves, row[0])
	}
	return cves
}
