package model

import (
	"github.com/anchore/siren-db/pkg/db"
)

type VulnerabilityIndex struct {
	PackageName          string
	Namespace            string
}

type Vulnerability struct {
	PK                   int                `storm:"id,increment"`
	Index                VulnerabilityIndex `storm:"index"`
	ID                   string
	RecordSource         string
	VersionConstraint    string
	VersionFormat        string
	CPEs                 []string
	ProxyVulnerabilities []string
}

func NewVulnerabilityModel(vulnerability db.Vulnerability) Vulnerability {
	return Vulnerability{
		Index: VulnerabilityIndex{
			PackageName:                   vulnerability.PackageName,
			Namespace:         vulnerability.Namespace,
		},
		ID:          vulnerability.ID,
		RecordSource:            vulnerability.RecordSource,
		VersionConstraint:    vulnerability.VersionConstraint,
		VersionFormat:        vulnerability.VersionFormat,
		CPEs:                 vulnerability.CPEs,
		ProxyVulnerabilities: vulnerability.ProxyVulnerabilities,
	}
}

func (m *Vulnerability) Inflate() db.Vulnerability {
	return db.Vulnerability{
		ID:                   m.ID,
		RecordSource:         m.RecordSource,
		PackageName:          m.Index.PackageName,
		Namespace:            m.Index.Namespace,
		VersionConstraint:    m.VersionConstraint,
		VersionFormat:        m.VersionFormat,
		CPEs:                 m.CPEs,
		ProxyVulnerabilities: m.ProxyVulnerabilities,
	}
}
